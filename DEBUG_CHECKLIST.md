# ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º—ã —É–¥–∞–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ (–¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å)

### 1.1. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
- [ ] –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "Console"
- [ ] –û—á–∏—Å—Ç–∏—Ç–µ –∫–æ–Ω—Å–æ–ª—å (Ctrl+L)

### 1.2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–£–¥–∞–ª–∏—Ç—å" —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —É–¥–∞–ª–µ–Ω–∏–µ
- [ ] –°–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏

### 1.3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏

**–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:**
```
[SettingsView] Super admin check: { currentUserEmail: "...", isSuperAdmin: true/false, ... }
[SettingsView] Created actingMember for super admin: { ... }
[SettingsView] Attempting to remove member: { workspaceId: "...", ... }
[FirestoreService] removeMember called: { workspaceId: "...", ... }
[FirestoreService] Member to delete: { userId: "...", email: "...", role: "..." }
[FirestoreService] Attempting deleteDoc: { path: "..." }
```

**–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫—É:**
```
[FirestoreService] Error deleting member: { code: "permission-denied", ... }
–û—à–∏–±–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞: ...
```

---

## –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ Firebase

### 2.1. –ü—Ä–∞–≤–∏–ª–∞ Firestore —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã?

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Firebase Console](https://console.firebase.google.com/)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Firestore Database** ‚Üí **Rules**
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø—Ä–∞–≤–∏–ª:
   - [ ] –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ñ—É–Ω–∫—Ü–∏—è `isSuperAdmin()` —Å —Ç—Ä–µ–º—è —Å–ø–æ—Å–æ–±–∞–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏
   - [ ] –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—Ä–∞–≤–∏–ª–æ `allow delete: if request.auth != null && (isSuperAdmin() || isAdminOrOwner(workspaceId));`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å:
   - [ ] –ö–Ω–æ–ø–∫–∞ "Publish" –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞ (–ø—Ä–∞–≤–∏–ª–∞ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã)
   - [ ] –ò–õ–ò –Ω–∞–∂–º–∏—Ç–µ "Publish" –µ—Å–ª–∏ –ø—Ä–∞–≤–∏–ª–∞ –Ω–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã

### 2.2. –î–æ–∫—É–º–µ–Ω—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è?

1. –í Firebase Console –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Firestore Database** ‚Üí **users**
2. –ù–∞–π–¥–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç —Å –≤–∞—à–∏–º `userId` (–º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ —á–µ—Ä–µ–∑ **Authentication** ‚Üí **Users**)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–ª—è:
   - [ ] –ï—Å—Ç—å –ø–æ–ª–µ `email: "crazymhessel@gmail.com"` (string)
   - [ ] –ò–õ–ò –µ—Å—Ç—å –ø–æ–ª–µ `isSuperAdmin: true` (boolean)

**–ï—Å–ª–∏ –ø–æ–ª–µ–π –Ω–µ—Ç:**
- –î–æ–±–∞–≤—å—Ç–µ –ø–æ–ª–µ `isSuperAdmin: true` (boolean) –≤ –¥–æ–∫—É–º–µ–Ω—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ò–õ–ò —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª–µ `email` —Å–æ–¥–µ—Ä–∂–∏—Ç `crazymhessel@gmail.com`

### 2.3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```javascript
import { auth } from './src/firebase';
import { getIdTokenResult } from 'firebase/auth';

const user = auth.currentUser;
if (user) {
  const token = await getIdTokenResult(user);
  console.log('Token email:', token.claims.email);
  console.log('All claims:', token.claims);
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- `Token email: "crazymhessel@gmail.com"` (–º–æ–∂–µ—Ç –±—ã—Ç—å `null` - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –¥–æ–∫—É–º–µ–Ω—Ç)

---

## –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–ª–µ–Ω—Å—Ç–≤–∞ –≤ workspace

### 3.1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —è–≤–ª—è–µ—Ç–µ—Å—å –ª–∏ –≤—ã —á–ª–µ–Ω–æ–º workspace

1. –í Firebase Console –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Firestore Database** ‚Üí **workspaces**
2. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à workspace
3. –û—Ç–∫—Ä–æ–π—Ç–µ –ø–æ–¥–∫–æ–ª–ª–µ–∫—Ü–∏—é **members**
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
   - [ ] –ï—Å—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç —Å –≤–∞—à–∏–º `userId`?
   - [ ] –ï—Å–ª–∏ –µ—Å—Ç—å, –∫–∞–∫–∞—è —Ä–æ–ª—å? (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å OWNER –∏–ª–∏ ADMIN)
   - [ ] –ï—Å–ª–∏ –Ω–µ—Ç, –Ω–æ –≤—ã —Å—É–ø–µ—Ä-–∞–¥–º–∏–Ω - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ (–∫–æ–¥ —Å–æ–∑–¥–∞—Å—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–π `actingMember`)

---

## –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª —á–µ—Ä–µ–∑ Rules Playground

1. –í Firebase Console –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Firestore Database** ‚Üí **Rules**
2. –ù–∞–∂–º–∏—Ç–µ **"Rules Playground"** (–≤–≤–µ—Ä—Ö—É —Å–ø—Ä–∞–≤–∞)
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ç–µ—Å—Ç:
   - **Location**: `workspaces/{workspaceId}/members/{memberId}`
   - **Operation**: `delete`
   - **Authenticated**: `true`
   - **User ID**: –≤–∞—à `userId` (–∏–∑ Authentication)
   - **Custom Claims**: –¥–æ–±–∞–≤—å—Ç–µ `email: "crazymhessel@gmail.com"` (–µ—Å–ª–∏ –µ—Å—Ç—å)
4. –ù–∞–∂–º–∏—Ç–µ **"Run"**
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
   - [ ] –î–æ–ª–∂–Ω–æ –±—ã—Ç—å `‚úÖ Allow` (–∑–µ–ª–µ–Ω–∞—è –≥–∞–ª–æ—á–∫–∞)
   - [ ] –ï—Å–ª–∏ `‚ùå Deny` - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—à–∏–±–∫—É

---

## –®–∞–≥ 5: –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ

–ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:

```javascript
// 1. –î–æ–±–∞–≤–∏—Ç—å isSuperAdmin –≤ –¥–æ–∫—É–º–µ–Ω—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
import { db, auth } from './src/firebase';
import { doc, updateDoc, getDoc } from 'firebase/firestore';

const user = auth.currentUser;
if (user) {
  const userRef = doc(db, 'users', user.uid);
  const userDoc = await getDoc(userRef);
  if (userDoc.exists()) {
    await updateDoc(userRef, { isSuperAdmin: true });
    console.log('‚úÖ –ü–æ–ª–µ isSuperAdmin –¥–æ–±–∞–≤–ª–µ–Ω–æ!');
    console.log('üîÑ –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
  } else {
    console.error('‚ùå –î–æ–∫—É–º–µ–Ω—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –Ω–∞–π–¥–µ–Ω');
  }
}
```

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:

- [ ] –õ–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- [ ] –ü—Ä–∞–≤–∏–ª–∞ Firestore —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã –∏ —Å–æ–¥–µ—Ä–∂–∞—Ç —Ñ—É–Ω–∫—Ü–∏—é `isSuperAdmin()`
- [ ] –î–æ–∫—É–º–µ–Ω—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ–¥–µ—Ä–∂–∏—Ç `isSuperAdmin: true` –ò–õ–ò `email: "crazymhessel@gmail.com"`
- [ ] Rules Playground –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `‚úÖ Allow` –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–∏ delete
- [ ] –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ï—Å–ª–∏ –≤—Å–µ –ø—É–Ω–∫—Ç—ã –æ—Ç–º–µ—á–µ–Ω—ã, –Ω–æ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π `workspaceId`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —É–¥–∞–ª—è–µ–º—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —è–≤–ª—è–µ—Ç—Å—è OWNER
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ –∫–æ–Ω—Å–æ–ª–∏ –Ω–µ—Ç –¥—Ä—É–≥–∏—Ö –æ—à–∏–±–æ–∫

