# üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Firestore –¥–ª—è —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## ‚ö†Ô∏è –í–∞–∂–Ω–æ: –ü—Ä–∞–≤–∏–ª–∞ Firestore –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–¥–µ–ø–ª–æ–µ–Ω—ã!

–ë–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª Firestore —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á –∏ –ø—Ä–æ–µ–∫—Ç–æ–≤ –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∏–∑-–∑–∞ –æ—à–∏–±–∫–∏ "Missing or insufficient permissions".

---

## üìã –®–∞–≥ 1: –î–µ–ø–ª–æ–π –ø—Ä–∞–≤–∏–ª Firestore

### –í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ Firebase Console (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Firebase Console](https://console.firebase.google.com/)
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Firestore Database** ‚Üí **Rules**
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `firestore.rules` –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞
5. –í—Å—Ç–∞–≤—å—Ç–µ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä –ø—Ä–∞–≤–∏–ª
6. –ù–∞–∂–º–∏—Ç–µ **"Publish"** (–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å)

### –í–∞—Ä–∏–∞–Ω—Ç B: –ß–µ—Ä–µ–∑ Firebase CLI

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Firebase CLI (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
npm install -g firebase-tools

# –í–æ–π–¥–∏—Ç–µ –≤ Firebase
firebase login

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –ø—Ä–æ–µ–∫—Ç (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω)
firebase init firestore

# –ó–∞–¥–µ–ø–ª–æ–π—Ç–µ –ø—Ä–∞–≤–∏–ª–∞
firebase deploy --only firestore:rules
```

---

## üìã –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤

–î–ª—è —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω—É–∂–Ω—ã –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–Ω–¥–µ–∫—Å–æ–≤.

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –ï—Å–ª–∏ –ø–æ—è–≤–∏—Ç—Å—è –æ—à–∏–±–∫–∞ —Å —Å—Å—ã–ª–∫–æ–π –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞ - –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ —Å—Å—ã–ª–∫—É
3. Firebase –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç –Ω—É–∂–Ω—ã–π –∏–Ω–¥–µ–∫—Å

### –†—É—á–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤

#### –ò–Ω–¥–µ–∫—Å 1: Collection Group –¥–ª—è `members`

–î–ª—è —Ä–∞–±–æ—Ç—ã –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ workspace (—á—Ç–æ–±—ã –Ω–∞—Ö–æ–¥–∏—Ç—å workspace, –≥–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —è–≤–ª—è–µ—Ç—Å—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–º):

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Firebase Console](https://console.firebase.google.com/)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Firestore Database** ‚Üí **Indexes**
3. –ù–∞–∂–º–∏—Ç–µ **"Create Index"**
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∏–Ω–¥–µ–∫—Å:
   - **Collection ID**: `members` (collection group)
   - **Fields to index**:
     - `userId` (Ascending)
     - `status` (Ascending)
   - **Query scope**: Collection group
5. –ù–∞–∂–º–∏—Ç–µ **"Create"**

#### –ò–Ω–¥–µ–∫—Å 2: –°–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å –¥–ª—è `projects`

–î–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ–µ–∫—Ç–æ–≤ –ø–æ workspace —Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π –ø–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è:

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Firebase Console](https://console.firebase.google.com/)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Firestore Database** ‚Üí **Indexes**
3. –ù–∞–∂–º–∏—Ç–µ **"Create Index"**
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∏–Ω–¥–µ–∫—Å:
   - **Collection ID**: `projects`
   - **Fields to index**:
     - `workspaceId` (Ascending)
     - `createdAt` (Descending)
   - **Query scope**: Collection
5. –ù–∞–∂–º–∏—Ç–µ **"Create"**

#### –ò–Ω–¥–µ–∫—Å 3: –°–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å –¥–ª—è `tasks`

–î–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞–¥–∞—á –ø–æ workspace —Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π –ø–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è:

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Firebase Console](https://console.firebase.google.com/)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Firestore Database** ‚Üí **Indexes**
3. –ù–∞–∂–º–∏—Ç–µ **"Create Index"**
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∏–Ω–¥–µ–∫—Å:
   - **Collection ID**: `tasks`
   - **Fields to index**:
     - `workspaceId` (Ascending)
     - `createdAt` (Descending)
   - **Query scope**: Collection
5. –ù–∞–∂–º–∏—Ç–µ **"Create"**

#### –ò–Ω–¥–µ–∫—Å 4: Collection Group –¥–ª—è `projects` (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

–ï—Å–ª–∏ –≤ –∫–æ–¥–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è collection group queries –¥–ª—è –ø—Ä–æ–µ–∫—Ç–æ–≤:

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Firebase Console](https://console.firebase.google.com/)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Firestore Database** ‚Üí **Indexes**
3. –ù–∞–∂–º–∏—Ç–µ **"Create Index"**
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∏–Ω–¥–µ–∫—Å:
   - **Collection ID**: `projects` (collection group)
   - **Fields to index**:
     - `workspaceId` (Ascending)
     - `createdAt` (Descending)
     - `__name__` (Ascending)
   - **Query scope**: Collection group
5. –ù–∞–∂–º–∏—Ç–µ **"Create"**

#### –ò–Ω–¥–µ–∫—Å 5: Collection Group –¥–ª—è `tasks` (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

–ï—Å–ª–∏ –≤ –∫–æ–¥–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è collection group queries –¥–ª—è –∑–∞–¥–∞—á:

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Firebase Console](https://console.firebase.google.com/)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Firestore Database** ‚Üí **Indexes**
3. –ù–∞–∂–º–∏—Ç–µ **"Create Index"**
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∏–Ω–¥–µ–∫—Å:
   - **Collection ID**: `tasks` (collection group)
   - **Fields to index**:
     - `workspaceId` (Ascending)
     - `createdAt` (Descending)
     - `__name__` (Ascending)
   - **Query scope**: Collection group
5. –ù–∞–∂–º–∏—Ç–µ **"Create"**

---

## üìã –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –ø—Ä–∞–≤–∏–ª –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É –∏–ª–∏ –ø—Ä–æ–µ–∫—Ç
3. –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ "Missing or insufficient permissions" - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
   - –ü—Ä–∞–≤–∏–ª–∞ –∑–∞–¥–µ–ø–ª–æ–µ–Ω—ã (Firebase Console ‚Üí Firestore ‚Üí Rules)
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —è–≤–ª—è–µ—Ç—Å—è —á–ª–µ–Ω–æ–º workspace (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ Firestore Console)
   - `workspaceId` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –ª–æ–≥–∞—Ö –∫–æ–Ω—Å–æ–ª–∏)

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–ª–µ–Ω—Å—Ç–≤–∞ –≤ workspace

–ß—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —á–ª–µ–Ω–æ–º workspace:

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Firebase Console](https://console.firebase.google.com/)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Firestore Database**
3. –û—Ç–∫—Ä–æ–π—Ç–µ `workspaces` ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à workspace ‚Üí `members`
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–∞–º –µ—Å—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç —Å –≤–∞—à–∏–º `userId` (–∏–∑ Firebase Auth)
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `status` = `'ACTIVE'`

---

## üêõ –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞: "Missing or insufficient permissions"

**–ü—Ä–∏—á–∏–Ω—ã:**
1. –ü—Ä–∞–≤–∏–ª–∞ Firestore –Ω–µ –∑–∞–¥–µ–ø–ª–æ–µ–Ω—ã
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —á–ª–µ–Ω–æ–º workspace
3. `workspaceId` –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∏–ª–∏ —Ä–∞–≤–µ–Ω `null`

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—Ä–∞–≤–∏–ª–∞ –∑–∞–¥–µ–ø–ª–æ–µ–Ω—ã –≤ Firebase Console
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á–ª–µ–Ω—Å—Ç–≤–æ –≤ workspace (—Å–º. –≤—ã—à–µ)
3. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
   ```javascript
   // –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏ –≤–∏–¥–∞:
   // "Creating project" { workspaceId: "...", name: "..." }
   // –∏–ª–∏
   // "Creating task" { workspaceId: "...", title: "..." }
   ```

### –û—à–∏–±–∫–∞: "Index required"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù—É–∂–µ–Ω –∏–Ω–¥–µ–∫—Å –¥–ª—è collection group query

**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞–π—Ç–µ –∏–Ω–¥–µ–∫—Å (—Å–º. –®–∞–≥ 2)

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

- [ ] –ü—Ä–∞–≤–∏–ª–∞ Firestore –∑–∞–¥–µ–ø–ª–æ–µ–Ω—ã —á–µ—Ä–µ–∑ Firebase Console –∏–ª–∏ CLI
- [ ] –ò–Ω–¥–µ–∫—Å –¥–ª—è `members` collection group —Å–æ–∑–¥–∞–Ω (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
- [ ] –ò–Ω–¥–µ–∫—Å –¥–ª—è `projects` —Å `workspaceId` –∏ `createdAt` —Å–æ–∑–¥–∞–Ω
- [ ] –ò–Ω–¥–µ–∫—Å –¥–ª—è `tasks` —Å `workspaceId` –∏ `createdAt` —Å–æ–∑–¥–∞–Ω
- [ ] –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è collection group queries —Å–æ–∑–¥–∞–Ω—ã (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è)
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —è–≤–ª—è–µ—Ç—Å—è —á–ª–µ–Ω–æ–º workspace (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ –≤ Firestore Console)
- [ ] –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–µ—Ç –æ—à–∏–±–æ–∫ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞—á/–ø—Ä–æ–µ–∫—Ç–æ–≤
- [ ] –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–µ—Ç –æ—à–∏–±–æ–∫ –ø—Ä–∏ –ø–æ–¥–ø–∏—Å–∫–µ –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- [ ] –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ `workspaceId` –∏ –¥—Ä—É–≥–∏–µ –¥–∞–Ω–Ω—ã–µ

---

## üìù –ë—ã—Å—Ç—Ä–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤–∏–ª

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞ (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Firebase CLI)
firebase firestore:rules:get
```

---

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Firebase Console](https://console.firebase.google.com/)
- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Firestore Rules](https://firebase.google.com/docs/firestore/security/get-started)
- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –∏–Ω–¥–µ–∫—Å–∞–º](https://firebase.google.com/docs/firestore/query-data/indexing)

