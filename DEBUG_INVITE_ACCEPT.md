# üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã: –ª—é–¥–∏ –Ω–µ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ

## –ü—Ä–æ–±–ª–µ–º–∞
–ü–æ—Å–ª–µ –ø—Ä–∏–Ω—è—Ç–∏—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ workspace.

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã

### 1. –ü—Ä–∞–≤–∏–ª–∞ Firestore –±–ª–æ–∫–∏—Ä—É—é—Ç —Å–æ–∑–¥–∞–Ω–∏–µ member
- –ü—Ä–æ–≤–µ—Ä–∫–∞ email –≤ —Ç–æ–∫–µ–Ω–µ –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ü—Ä–∞–≤–∏–ª–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–∏–º

### 2. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
- –û—à–∏–±–∫–∞ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–∫—Ä—ã—Ç–∞
- Member –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ Firestore

### 3. –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
- Collection group query –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç –Ω–æ–≤—ã–π member
- Workspace –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ

---

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–æ –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è member

**–§–∞–π–ª:** `firestore.rules` (—Å—Ç—Ä–æ–∫–∞ 148-160)

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:**
```javascript
// –ë–´–õ–û:
(request.auth.uid == memberId && 
 request.resource.data.userId == request.auth.uid &&
 request.resource.data.status == 'ACTIVE' &&
 request.auth.token.email != null &&
 request.resource.data.email == request.auth.token.email)

// –°–¢–ê–õ–û:
(request.auth.uid == memberId && 
 request.resource.data.userId == request.auth.uid &&
 request.resource.data.status == 'ACTIVE' &&
 // Email –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å –≤ —Ç–æ–∫–µ–Ω–µ
 (request.auth.token.email == null || 
  request.resource.data.email == request.auth.token.email ||
  request.resource.data.email.toLowerCase() == request.auth.token.email.toLowerCase()))
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:**
- –¢–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –µ—Å–ª–∏ email –≤ —Ç–æ–∫–µ–Ω–µ —Ä–∞–≤–µ–Ω `null`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ email –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –±–µ–∑ —É—á–µ—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞

### 2. –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ acceptInvite

**–§–∞–π–ª:** `src/services/firestore.ts`

–î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è member
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫

---

## üìã –®–∞–≥ 1: –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ Firestore

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Firebase Console](https://console.firebase.google.com/)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Firestore Database** ‚Üí **Rules**
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `firestore.rules` –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞
4. –í—Å—Ç–∞–≤—å—Ç–µ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä –ø—Ä–∞–≤–∏–ª
5. –ù–∞–∂–º–∏—Ç–µ **"Publish"**

---

## üìã –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø—Ä–∏–Ω—è—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ
3. –°–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏:
   - –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏ `[acceptInvite]` —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø—Ä–æ—Ü–µ—Å—Å–µ
   - –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ - –±—É–¥–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

---

## üìã –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ Firestore Console

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Firebase Console](https://console.firebase.google.com/)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Firestore Database**
3. –û—Ç–∫—Ä–æ–π—Ç–µ `workspaces` ‚Üí –≤–∞—à workspace ‚Üí `members`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
   - –ï—Å—Ç—å –ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç —Å `userId` –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?
   - –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –ø–æ–ª—è (`email`, `role`, `status`)?

---

## üêõ –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã?
- Firebase Console ‚Üí Firestore ‚Üí Rules
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è member —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–æ–≤–µ—Ä–∫—É `request.auth.token.email == null ||`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–∞–≤–∏–ª–∞ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –õ–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏
1. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø—Ä–∏–Ω—è—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ
3. –°–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ `[acceptInvite]`:
   - –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –ª–æ–≥ "Transaction completed successfully"
   - –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ - –±—É–¥–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: Member —Å–æ–∑–¥–∞–Ω?
1. Firebase Console ‚Üí Firestore ‚Üí `workspaces` ‚Üí –≤–∞—à workspace ‚Üí `members`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ —Å `userId` –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –ï—Å–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –Ω–µ—Ç - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 4: Email —Å–æ–≤–ø–∞–¥–∞–µ—Ç?
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å email –≤ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–∏
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –≤ —Å–∏—Å—Ç–µ–º–µ

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç

- [ ] –ü—Ä–∞–≤–∏–ª–∞ Firestore —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã
- [ ] –ü—Ä–∞–≤–∏–ª–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è member —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–æ–≤–µ—Ä–∫—É `request.auth.token.email == null ||`
- [ ] –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –µ—Å—Ç—å –ª–æ–≥–∏ `[acceptInvite]`
- [ ] Member —Å–æ–∑–¥–∞–Ω –≤ Firestore (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ –≤ Firebase Console)
- [ ] Workspace –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ –ø–æ—Å–ª–µ –ø—Ä–∏–Ω—è—Ç–∏—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è

---

## üéâ –ì–æ—Ç–æ–≤–æ!

–ü–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –ø—Ä–∞–≤–∏–ª –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–æ–≥–æ–≤ –ø—Ä–∏–Ω—è—Ç–∏–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!

